---
title: Validator Setup
description: Setup Process for new SKALE Validator
---
import { Step, Steps, Aside } from "@astrojs/starlight/components";

<Steps>

1. ## Setup Validator
    
    <Aside type="note">Due date 20th day of each month</Aside>

    ### 1.1 Prepare

    #### 1.1.1 Obtain Ethereum Software Wallet or Hardware wallet

    Get a Ledger, Hardware or Software wallet ready like Metamask/Portis/Bitski/Torus/myetherwallet.
    Specific setup instructions will follow.

    This wallet will be used for receiving delegation, bounties, and self delegating.

    #### 1.1.2 Fund Validator Wallet with ETH

    Be ready to have some ETH to accept delegations and link your validator node.
    Remember these are transactions with SKALE Manager on Ethereum, and therefore require ETH.

    *Minimum ETH: 1.0*

    #### 1.1.3 Get SKALE Manager contract ABIs from SKALE

    [https://raw.githubusercontent.com/skalenetwork/skale-network/master/releases/mainnet/skale-manager/1.11.0/skale-manager-1.11.0-mainnet-abi.json](https://raw.githubusercontent.com/skalenetwork/skale-network/master/releases/mainnet/skale-manager/1.11.0/skale-manager-1.11.0-mainnet-abi.json)

    #### 1.1.4 Fund SRW Wallet with ETH

    Be ready to fund ETH in your self-recharging wallet (SRW). See [Self-recharging wallet documentation](/ecosystem/validators/validator-cli/self-recharding-wallets).

    *Minimum ETH*: <math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mn>0.5</mn><mo>&#x2219;</mo><mi>node</mi><mo>&#xA0;</mo><mi>count</mi></mrow></math>

    #### 1.1.5 Decide your commission fee

    Decide on your commission fee. This cannot be changed once it is set. To set a new commission fee, you'll have to register a new validator.
    This new validator would have to link nodes and accept delegations for it (old validator nodes and delegations cannot be rolled into a
    new validator commission fee).

    _Reference Documents_
    - [Validator & Token Economics](https://skale.network/blog/validator-economics)
    - [Tokenomics](https://skale.network/tokenomics)

    ### 1.2 Register Validator

    SKALE Validator CLI is the validator client interface for registering a new validator into network or handling additional
    delegation services where validators can self delegate or token holders can delegate to a validator. These are the type of
    operations that can be done with the Validator CLI:

    - Register Validator (Set Commission Rate or Minimum delegation amount)
    - Accept pending delegations
    - Link all validator node addresses to a validator wallet address
    - Request or cancel a delegation

    [See the SKALE Validator CLI documentation](/ecosystem/validators/validator-cli/overview)

    This document contains instructions on how to get started with the SKALE Validator CLI.

    <Aside type="note">
        Validator CLI doesn't have to be installed in the same server as the node-cli. This can be set up on Mac or Linux.
        This does not need to be included in every node. Setting up once per validator organization is sufficient.
    </Aside>

    #### 1.2.1 Install SKALE Validator CLI

    ##### Download the SKALE Validator CLI binary

    `VERSION_NUM` is a version identifier

    ```shell
    VERSION_NUM=[VERSION_NUM] && sudo -E bash -c "curl -L https://github.com/skalenetwork/validator-cli/releases/download/$VERSION_NUM/sk-val-$VERSION_NUM-`uname -s`-`uname -m` >  /usr/local/bin/sk-val"
    ```

    ##### Apply executable permissions to the binary

    ```shell
    chmod +x /usr/local/bin/sk-val
    ```

    ##### Set SKALE Manager contracts info and set the endpoint

    ```shell
    sk-val init -e [ENDPOINT] -c [ABI] --wallet [software/ledger]
    ```

    Required arguments:

    - `--endpoint/-e` - RPC endpoint of the node in the network where SKALE manager is deployed (http or https). Example is https://my.geth.node.ip/..

    - `--contracts-url/-c` - URL to SKALE Manager contracts ABI and addresses

    - `-w/--wallet` - Type of the wallet that will be used for signing transactions (software or ledger)

    #### 1.2.2 Setup wallet

    ##### Software wallet

    If you want to use software wallet you need to save private key into a file.

    Replace `[YOUR PRIVATE KEY]` with your wallet private key

    ```shell
    echo [YOUR PRIVATE KEY] > ./pk.txt
    ```

    ##### Ledger  wallet

    If you want to use ledger you should install ETH ledger application and  initialize device with `setup-ledger` command.

    ```shell
    sk-val wallet setup-ledger --address-index [ADDRESS_INDEX] --keys-type [KEYS_TYPE]
    ```

    Required arguments:

    -   `--address-index` - Index of the address to use (starting from `0`)
    -   `--keys-type` - Type of the Ledger keys (live or legacy)

    <Aside type="note" title="Important">
    Make sure you enabled blind signing on ETH application settings. Otherwise transactions won't work
    </Aside>
    
    #### 1.2.3 Register as a new SKALE validator

    <Aside type="caution" title="Warning">
    DON'T REGISTER A NEW VALIDATOR IF YOU ALREADY HAVE ONE! check : `sk-val validator ls`. For additional node set up, please go to Step 3.
    </Aside>

    ```shell
    sk-val validator register -n [NAME] -d [DESCRIPTION] -c [COMMISSION_RATE] --min-delegation [MIN_DELEGATION]
    ```

    Required arguments:

    -   `--name/-n` - Validator name
    -   `--description/-d` - Validator description (preferably organization info)
    -   `--commission-rate/-c` - Commission rate (percent %)
    -   `--min-delegation` - Validator minimum delegation amount

    Optional arguments:

    -   `--pk-file` - Path to file with private key (only for `software` wallet type)
    -   `--gas-price` - Gas price value in Gwei for transaction (if not specified doubled average network value will be used)
    -   `--yes` - Confirmation flag

    ### 1.3 Make sure that your validator is added to the trusted list

    To ensure that your validator is added to trusted contact SKALE team.

    <Aside type="note" title="Important">
    This is a temporary process, which will be removed as the community matures.
    </Aside>
2. ## Setup SGX

    <Aside type="note">
    Due date: 23rd of each month
    </Aside>

    ### 2.1 Overview

    SGX is a secure storage for BLS private key shares, which are used in consensus to sign new blocks.
    SGX is also used for private key shares.

    SKALE DKG uses Intel® SGX server to store account and BLS keys and all the data related to DKG process
    and it also uses the random number generator provided by Intel® SGX. For more information,
    please check [here](/learn/advanced/dkg-bls).

    Clients connect to the server, authenticate to it using TLS 1.0 protocol with client certificates, and then
    issue requests to the server to generate crypto keys and perform cryptographic operations. The keys are
    generated inside the secure SGX enclave and never leave the enclave unencrypted.

    ### 2.2 Configure server

    To be able to set up an SGXWallet, validators are required to have SGX compatible servers. Before installing SGXWallet, validators must make sure that SGX is enabled in the server.

    #### 2.2.1 Server Requirements

    - Ubuntu 20.04 (focal)
    - SGX-enabled Intel processor
    - At least 8 GB
    - Swap size equals to half (1/2) of RAM size

    ### 2.3 Configure Network

    It's required to setup VPN between nodes and SGX server. Ports 1026-1031 should  open only to SKALE Nodes, not public ports should be accessible by node.

    <Aside type="note">
    SGXWallet can support up to <strong>5</strong> SKALE nodes. If you have more, you should setup additional server.
    </Aside>

    ### 2.4 Install and Configure Packages 

    Before running SGXWallet install the following packages

    **Install general tools:**

    ```shell
    sudo apt-get install -y build-essential make cmake gcc g++ yasm  python libprotobuf10 flex bison automake libtool texinfo libgcrypt20-dev libgnutls28-dev
    ```

    **Install Docker:**

    ```shell
    sudo apt-get install -y docker
    ```

    **Install docker.io:**

    ```shell
    sudo apt-get install -y docker.io
    ```

    **Install docker-compose:**

    ```shell
    sudo apt-get install -y docker-compose
    ```

    **Install cpuid and libelf-dev packages:**

    ```shell
    sudo apt-get install -y libelf-dev cpuid
    ```

    **Verify your processor supports Intel SGX with:**

    ```shell
    cpuid | grep SGX:
    ```

    <Aside type="caution" title="Important">
    After installing docker make sure that `live-restore` option
    is enabled in `/etc/docker/daemon.json`. See more info in the [docker docs](https://docs.docker.com/config/containers/live-restore/).
    </Aside>

    **Disable automatic updates**

    It's recommended to only update the SGXWallet server if there are critical security fixes. This is because SGXWallet is based on new low
    level technology, and kernel updates may break the system. Currently SGX is tested on 4.15-\* kernels. It's best to avoid minor version updates too.

    To make sure `apt update` won't update the kernel you should use apt-mark hold command:

    ```shell
    sudo apt-mark hold linux-generic linux-image-generic linux-headers-generic
    ```

    Also if you configured unattended upgrades, you should make sure kernel won't update automatically. To do this, add the following lines to `/etc/apt/apt.conf.d/50unattended-upgrades` file:

    ```shell
    Unattended-Upgrade::Package-Blacklist {
            "linux-generic";
            "linux-image-generic";
            "linux-headers-generic";
    };
    ```

    **Output**

    ```shell
    SGX: Software Guard Extensions supported = true
    ```

    ### 2.5 Download SGXWallet source code

    #### 2.5.1 Clone SGXWallet Repository

    Clone SGX Wallet Repository to your SGX compatible Server:

    ```shell
    git clone https://github.com/skalenetwork/sgxwallet/
    cd sgxwallet
    git checkout tags/ADD_VERSION_TAG
    ```

    #### 2.5.2 Enable SGX

    **SGX Wallet repository includes the sgx_enable utility. To enable SGX run:**

    ```shell
    sudo ./sgx_enable
    ```

    Note: if you aren't using Ubuntu 18.04 (not recommended), you may need to rebuild the sgx-software-enable utility before use by typing:

    ```shell
    cd sgx-software-enable;
    make
    cd ..
    ```

    **Install SGX Library:**

    ```shell
    cd scripts
    sudo ./sgx_linux_x64_driver_2.5.0_2605efa.bin
    cd ..
    ```

    **System Reboot:**

    <Aside type="note">
    Reboot your machine after driver install!
    </Aside>

    **Check driver installation:**
    To check that isgx device is properly installed run this command:

    ```shell
    ls /dev/isgx
    ```

    If you don't see the isgx device, you need to troubleshoot your driver installation from [here](https://github.com/skalenetwork/sgxwallet/blob/develop/docs/enabling-sgx.md).

    **Another way to verify Intel SGX is enabled in BIOS:**

    <Aside type="note">
    **_If you already executed the previous steps please move to STEP 3_**
    </Aside>

    Enter BIOS by pressing the BIOS key during boot. The BIOS key varies by manufacturer and could be F10, F2, F12, F1, DEL, or ESC.

    Usually Intel SGX is disabled by default.

    To enable:

    find the Intel SGX feature in BIOS Menu (it's usually under the "Advanced" or "Security" menu)
    Set SGX in BIOS as enabled (preferably) or software-controlled.
    save your BIOS settings and exit BIOS.
    Enable "software-controlled" SGX
    Software-controlled means that SGX needs to be enabled by running a utility.

    ### 2.6 Update docker-compose.yaml

    Open run_sgx directory

    ```shell
    cd sgxwallet/run_sgx;
    ```

    On some machines, the SGX device isn't **/dev/mei0** but a different device, such as **/dev/bs0** or **/dev/sg0**. In this case please edit docker-compose.yml on your machine to specify the correct device to use:

    ```shell
    vi docker-compose.yml
    ```

    make sure `image` is skalenetwork/sgxwallet:&lt;`SGX_VERSION`> in docker-compose and it will look like:

    ```shell
    version: '3'
    services:
      sgxwallet:
        image: skalenetwork/sgxwallet:<SGX_VERSION>
        ports:
          - "1026:1026"
          - "1027:1027"
          - "1028:1028"
          - "1029:1029"
        devices:
          - "/dev/isgx"
          - "/dev/sg0"
        volumes:
          - ./sgx_data:/usr/src/sdk/sgx_data
          -  /dev/urandom:/dev/random
        logging:
          driver: json-file
          options:
            max-size: "10m"
            max-file: "4"
        restart: unless-stopped
        command: -s -y -V
        healthcheck:
          test: ["CMD", "ls", "/dev/isgx", "/dev/"]
    ```



    ### 2.7 Spin up SGXWallet Container

    **Start SGX Wallet Containers**
    To run the server as a daemon:

    ```shell
    sudo docker-compose up -d
    ```

    ### 2.8 Securely save generated backup key

    The backup key is automatically stored in *sgx_data* directory.

    The filename of the key is sgx_wallet_backup_key.txt, and is generated the first time the SGX wallet is started.

    <Aside type="caution" title="Important">
    **This key must be securely recorded and stored.**
    Be sure to store this key in a safe place, then go into a docker container and securely remove it with the following command:
    </Aside>

    ```shell
    docker exec -it <SGX_CONTAINER_NAME> bash && apt-get install secure-delete && srm -vz backup_key.txt
    ```

    <Aside type="note">
    You should enable SSL/TLS for your SGX node. Make sure you finalize this before you move on to your next step.
    </Aside>


    ### 2.9 Backup sgx data

    It's strongly recommended to backup sgx data regularly. The guide can be found [here](https://github.com/skalenetwork/sgxwallet/blob/stable/docs/backup-procedure.md).
</Steps>